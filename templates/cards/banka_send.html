{% extends 'layout.html' %}
{% load static %}

{% block title %}–ë–∞–Ω–∫–∞ –Ω–∞–∫–æ–ø–∏—á—É–≤–∞–Ω–Ω—è{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'cards/css/banka_send.css' %}">

{% if user.is_authenticated %}
    <a href="javascript:history.back()" class="back-button">‚Üê –ù–∞–∑–∞–¥</a>

    <div class="transfer-container">
        <h1>–ü–µ—Ä–µ–∫–∞–∑–∞—Ç–∏ –≥—Ä–æ—à—ñ</h1>

        <form id="transfer-form" method="POST">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="id_transfer_type">–¢–∏–ø –ø–µ—Ä–µ–∫–∞–∑—É:</label>
                {{ form.transfer_type }}
            </div>

            <div class="form-group">
                <label for="id_amount">–°—É–º–∞:</label>
                {{ form.amount }}
            </div>

            <div class="form-group">
                <label for="id_hash_code">–•–µ—à-–∫–æ–¥ —á—É–∂–æ—ó –±–∞–Ω–∫–∏:</label>
                {{ form.hash_code }}
            </div>

            <button type="submit" class="submit-btn">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
        </form>

        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ —Ö–µ—à –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ —á—É–∂–∞—è –±–∞–Ω–∫–∞ -->
        <div id="hash-error-message" class="error-message" style="display: none;">
            –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ö–µ—à-–∫–æ–¥ —á—É–∂–æ—ó –±–∞–Ω–∫–∏, —è–∫—â–æ –≤–∏ –≤–∏–±—Ä–∞–ª–∏ –ø–µ—Ä–µ–∫–∞–∑ –Ω–∞ —á—É–∂—É –±–∞–Ω–∫—É.
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ö–µ—à-–∫–æ–¥–µ -->
        <div id="wrong-hash-message" class="error-message" style="display: none;">
            –ù–µ–≤—ñ—Ä–Ω–∏–π —Ö–µ—à-–∫–æ–¥ —á—É–∂–æ—ó –±–∞–Ω–∫–∏. –ë—É–¥—å –ª–∞—Å–∫–∞, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–≤–µ–¥–µ–Ω–∏–π —Ö–µ—à.
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
        <div id="error-message" class="error-message" style="display: none;"></div>
            {% if messages %}
                <div class="alert-messages">
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –ø–µ—Ä–µ–≤–æ–¥–µ -->
        <div id="success-message" class="success-message" style="display: none;">
            –ü–µ—Ä–µ–∫–ª–∞–¥ —É—Å–ø—ñ—à–Ω–æ –≤–∏–∫–æ–Ω–∞–Ω–æ!
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var transferTypeField = document.getElementById("id_transfer_type");
            var hashCodeField = document.getElementById("id_hash_code").closest("div");
            var hashCodeInput = document.getElementById("id_hash_code");
            var errorMessage = document.getElementById("error-message");
            var successMessage = document.getElementById("success-message");
            var hashErrorMessage = document.getElementById("hash-error-message");
            var wrongHashMessage = document.getElementById("wrong-hash-message");

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ –ø–µ—Ä–µ–≤–æ–¥–∞
            transferTypeField.addEventListener("change", function() {
                if (this.value == "self") {
                    hashCodeField.style.display = "none";  // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ —Ö–µ—à-–∫–æ–¥–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞ —Å–≤–æ—é –±–∞–Ω–∫—É
                } else {
                    hashCodeField.style.display = "block";  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ —Ö–µ—à-–∫–æ–¥–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞ —á—É–∂—É—é –±–∞–Ω–∫—É
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            document.getElementById("transfer-form").addEventListener("submit", function(event) {
                // –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                errorMessage.style.display = "none";
                successMessage.style.display = "none";
                hashErrorMessage.style.display = "none";  // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –¥–ª—è —Ö–µ—à-–∫–æ–¥–∞
                wrongHashMessage.style.display = "none";  // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –¥–ª—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ö–µ—à-–∫–æ–¥–∞

                // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ —á—É–∂—É—é –±–∞–Ω–∫—É, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω –ª–∏ —Ö–µ—à-–∫–æ–¥
                if (transferTypeField.value == "other" && hashCodeInput.value.trim() === "") {
                    event.preventDefault();  // –û—Ç–º–µ–Ω—è–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã
                    hashErrorMessage.style.display = "block";  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –¥–ª—è —Ö–µ—à-–∫–æ–¥–∞
                }
            });
        });
    </script>

    <div class="footer-text">
        *–ë–∞–Ω–∫–∞ —î –∑–±–µ—Ä—ñ–≥–∞–ª—å–Ω–∏–º —Ä–∞—Ö—É–Ω–∫–æ–º —ñ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –æ—Å–Ω–æ–≤–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
    </div>
{% else %}
    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; text-align: left;">
        <img src="https://cdn-icons-png.flaticon.com/512/1828/1828843.png" alt="–•—Ä–µ—Å—Ç" style="width: 50px; height: 50px; margin-right: 15px;">
        <h1 style="font-size: 30px; max-width: 500px; line-height: 1.4;">
            –û–π –ª–∏—Ö–æ, —Å—Ö–æ–∂–µ –≤–∞–º —Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è... ü´£
        </h1>
    </div>
{% endif %}

{% endblock %}