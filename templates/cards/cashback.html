{% extends 'layout.html' %}

{% block title %}–ö–µ—à–±–µ–∫{% endblock %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'cards/css/mobile.css' %}">
<link rel="stylesheet" href="{% static 'cards/css/cashback.css' %}">

{% if user.is_authenticated %}
    <a href="javascript:history.back()" class="back-button">‚Üê –ù–∞–∑–∞–¥</a>

    <div class="cashback-container">
        <h2>–í–∞—à –∫–µ—à–±–µ–∫</h2>

        <div class="progress-bar-container">
            <span class="progress-text progress-left">{{ cashback_data.get_total_cashback }} –≥—Ä–Ω</span>
            <span class="progress-text progress-right">5160.00 –≥—Ä–Ω</span>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ cashback_percentage }}%;"></div>
            </div>
        </div>

        <h3>–†–æ–∑–ø–æ–¥—ñ–ª –∫–µ—à–±–µ–∫—É
            <button class="remove-button" id="remove-cashback-btn">–ó–Ω—è—Ç–∏ –≤—Å–µ</button>
        </h3>

        <div class="category-list">
            <div class="category">
                <span>–ö–∞—Ñ–µ —Ç–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∏</span>
                <span><strong>{{ cashback_data.cafe_restaurants }} –≥—Ä–Ω</strong></span>
            </div>
            <div class="category">
                <span>–î–∏—Ç—è—á—ñ –º–∞–≥–∞–∑–∏–Ω–∏</span>
                <span><strong>{{ cashback_data.kids_stores }} –≥—Ä–Ω</strong></span>
            </div>
            <div class="category">
                <span>–ï–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç–∏</span>
                <span><strong>{{ cashback_data.e_scooters }} –≥—Ä–Ω</strong></span>
            </div>
            <div class="category">
                <span>–ö—ñ–Ω–æ—Ç–µ–∞—Ç—Ä–∏</span>
                <span><strong>{{ cashback_data.cinemas }} –≥—Ä–Ω</strong></span>
            </div>
            <div class="category">
                <span>–ü—Ä–æ—ó–∑–¥</span>
                <span><strong>{{ cashback_data.transport }} –≥—Ä–Ω</strong></span>
            </div>
            <div class="category">
                <span>–ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –º–æ–±—ñ–ª—å–Ω–æ–≥–æ</span>
                <span><strong>{{ cashback_data.mobile_recharge }} –≥—Ä–Ω</strong></span>
            </div>
            <div class="category">
                <span>–ü–∞—Ä–∫–æ–≤–∫–∞</span>
                <span><strong>{{ cashback_data.parking }} –≥—Ä–Ω</strong></span>
            </div>
        </div>

        <div id="success-message" class="hidden">
            <p>–í–∏ —É—Å–ø—ñ—à–Ω–æ –∑–Ω—è–ª–∏ –≤–µ—Å—å –∫–µ—à–±–µ–∫ –Ω–∞ –≤–∞—à—É –∫–∞—Ä—Ç–∫—É!</p>
        </div>
    </div>

{% else %}
    <div class="auth-error">
        <img src="https://cdn-icons-png.flaticon.com/512/1828/1828843.png" alt="–•—Ä–µ—Å—Ç">
        <h1>–û–π –ª–∏—Ö–æ, —Å—Ö–æ–∂–µ –≤–∞–º —Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è... ü´£</h1>
    </div>
{% endif %}

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const removeButton = document.getElementById("remove-cashback-btn");
        const successMessage = document.getElementById("success-message");

        removeButton.addEventListener("click", function () {
            fetch("{% url 'cards:remove_cashback' %}", {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}"
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    successMessage.classList.remove("hidden");
                    removeButton.style.display = "none";
                    animateCashbackReset();
                } else {
                    alert("–©–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.");
                }
            });
        });

        function animateCashbackReset() {
            const progressBar = document.querySelector(".progress-fill");
            progressBar.style.transition = "width 0.5s ease-in-out";
            progressBar.style.width = "0%";
        }
    });
</script>

{% endblock %}